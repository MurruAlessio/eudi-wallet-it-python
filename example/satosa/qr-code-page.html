<!DOCTYPE html>
<html lang="it">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IT Wallet QRCode</title>
    <meta name="description" content="IT Wallet QRCode">
    <link rel="shortcut icon" href="spid/favicon-32x32.png">
    
    <link rel="stylesheet" href="static/bootstrap-italia/css/bootstrap-italia.min.css">
    <link rel="stylesheet" href="static/css/style.css">

    <script src="static/js/jquery-3.7.0.min.js"></script>
  </head>
  <body>
          <div class="qr-code-box">
            <div class="card-body">
                <div class="row border-md-bottom-title">
                  <p class="qr-code-title">Inquadra il QR code</p>
                </div>
                <div class="col-lg-12 text-center">
                  <!-- Wallet it button section -->
                  <!-- <div class="row text-center border-md-bottom-title">
                      <h1 class="title-wallet"><svg class="it-wallet-logo" ><use style="fill: #0065cc; stroke: #0065cc;" href="wallet-it/wallet_12.svg#wallet_12"></use></svg> IT Wallet </h1>
                  </div> -->
                  <div class="row">
                    <div class="qr-code-text">Inquadra il QR code con la fotocamera del tuo smartphone, oppure utilizza la funzionalità "inquadra" disponibile nell'app IO.</div>
                  </div>
                  <br>
                  <div class="row">
                    <span><img id="qrcodeImage" src="templates/qrcode.svg" alt="Logo CIE" /></span>
                    <p class="text-helper">Il codice è valido per <b>120</b> secondi</p>
                  </div>
                  <div class="row">
                    <div class="col-lg-2 text-center button-container ">
                      <button class="btn btn-outline-primary">
                        <span>Annulla</span>
                      </button>
                    </div>
                  </div>
                </div>
            </div>
          </div>
        <!-- <div class="alert alert-info">
          Le informazioni e la disposizione degli elementi visivi di questa pagina non sono definiti a livello normativo e potrebbero essere soggetti a modifiche.
        </div> -->
    <script src="static/bootstrap-italia/js/bootstrap-italia.bundle.min.js"></script>

    <div class="fullscreen-overlay visually-hidden">
      <div class="progress-spinner progress-spinner-double progress-spinner-active">
        <div class="progress-spinner-inner"></div>
        <div class="progress-spinner-inner"></div>
        <span class="visually-hidden">Caricamento...</span>
      </div>
    </div>
    <script>
      function mock(){
        setTimeout(function() {
            document.querySelector(".fullscreen-overlay").classList.remove("visually-hidden");
        }, 2000);
        
        setTimeout(function() {
            window.location.href = "http://localhost:8080/";
        }, 4000);
      }

      function StartQRcodeScanCheck(){
        setTimeout(QRcodeScanCheck
        , 5000);
      }

      function redirectToSP(data, textStatus, jqXHR) {
        console.log('redirectToSP');
        //redirect to SP
      }

      function redoStatusCheck(data, textStatus, jqXHR) {
        console.log(201)
        //Sets up a qrcode scan status check once again
        StartQRcodeScanCheck()
      }

      function QRcodeScanCheck() {
        let endpointSatosa = 'http://localhost:3000/test';
        let data = {
          "session-id": "session-id", 
        };

        let ajaxRequest = $.ajax({
          type: 'POST',
          url: endpointSatosa,
          data,
          statusCode: {
            200: redirectToSP,
            201: redoStatusCheck
          }
        })

        return ajaxRequest;
      }

      StartQRcodeScanCheck();
    </script>
  </body>
</html>
